/*
                                          ` \uJYUQmQ{     ~j                                                             `  ' '''            +_+_??[{)
                                            j/uxXzZ_'`      Y                                                                    '            ~__--???
                                            ]fnfXz ''`       b                                                          '        '`            ~_-----
                                            _frj   '''''      m                                                            `      '`             +____
                                            }\t+ '   ''''      [1                                                           '     ''              ~+__
                                            \|f('    ''''`      ~0'                                                          ` ' '''`               ~+
                                            (t+' '' ''''''``      b                                                           '''''''`                
                                            f}      ''''''''`      j '                                                '      '  '''' ''               
                                              `'   '''  ''````      }u                                                `   `   '` ''' '''              
                                             \ '   ''   ''`````     ~~b'                                                '   `   ` ' ''''`             
                                            '(_'   ''  ' ``````        h                                               `          1'''''''            
                                             '0     ' '' ````````      +U-`                                                   ''``''''''''``          
                                               v''''''''`''''`````      _Xx'                                             (' ''`            `          
                                               U-`''''''''`'`'````'      __& '                        `'                  1`'''                       
                                               'a ''''''''''''''`''`        |1'                           '               {`'''            ~++++++~~~ 
                                                'b '''' ''''''''````          Z`                          '' '''  ff~   '  )' '           ++][}11))1{}
                                                '`W '''''''''''''''''          p''                  '   '``    `''''''`  Q*zh`'`         ~++__+ ~[{(/f
                                                   o'''''''''''''''''`          r-             `'     + ''`            `'''' ''`         +___]a`    ' 
                                           `` `''  'w '''''''''''''''`           {J   ~_}O_ )      `' (+'`     +++            ``          +_]\_`      
                                 `            ''`''` m'''''''''''''''''            c  +?(+x)-j~?  j    \  `     +mo0                      ~-?&        
                         ' ``       '`    ``'   X ~' ]Q ``''''''''''`'`             n]?  {]}j1\1uY _   tC``    ~?&\```+an +                ~/X`       
                        '  `          ` `        n|Y- 1O''''''''``'''''            __|t?]?]))1(]j_Utf(~+wJ    _hwQ{    '`  kvv             ~*'        
                   '         ' ``           c  ~  - ])rrn`'''''''''''              _??\/}?{[1{)j]U{jYn{|-q* XtfjjZ\   ] +  +' wqJQ_         C         
            '```      ' `             + t+ ] C+   ) ~}~}//'''''''''                _?]?/))11}?{)1{[j1C)-Ycof1(/txp1Q#CJf?__ +'  ' ?uZ#t    L[         
             '                     z)+r _/  +  +_  [_ _+_]1  `````              ```'''''''`` +)frrvnznXrn/0p(\fjc#|Qc/X(}x j   '+       zokb          
                        +          +Q  [)x  } )     _]~  +_[ ~ ````````''''''''''''''''''''''''''' {fnxY0Zn0Z/xrc*Yk}p{v}]Z({_[_ _ '      '           
        '`        ??_++~       n  /+ ~  r[u?-1~|_ ?~~_  ?  ''''''''''```````````''''''''''''''''''''`  (uJz/kOzzXqkjM\*jJ[)x(_  +                     
       '        _+-?+~~++ ~?    t  -    ~_~)[~(?-+]-)- '''''''''`''''''''`````'''`''``'''''''''''''''''''`  coQJJpc*x0zv/(n\_/]\  -  +'               
      `     ~_++_-?-++_{~u    \  ~    _+?t _)tt[1/? `'''''''''''``````'```````````````'''```````''````''''``  _+kpoW%YjwvqnjrYx1z _} ~{''             
    '      +++___?++ ~ v}   x)   ] x?  ([{ {}(Xf '`''''''''''''````````'`````````````````````````````'''''`'```   ?&MBhYd)dxYbvnz)- v[ [  '           
  '`     _} {+--_-__}X[+~ +   _k[ t{~r|-)j)/m~ '''''''''''''''''''''``````````````````````````````````````````````' ]o%*jWLZbckaaYO{}[|~ ( ' '        
  '     -  }??]{__ /O+     ?{  v/?(c {}fCJr'''''''''''`''`  ` ?{}  ``'````````````````````````````````````````''``````+q%XQknaYnouzmY/]x]-_    '      
  `       -_1]-+?? { ~   -n tYf~-\z_]fnqn ''''''' '''' -w&aWM%@@@8M##  ```````````````'`````````````````````````'`''``` n@88LzqkOQYXnv0?\_) )` '      
'`       ]?_??--+++    {a? u ?Cr[-b   k ''''''''''''/b&b%8%BB@B@%&u  -w'````````````````````````````````````````''''``''  bpBkZ*n0pX)tXf+_Y-  ]       
        } ]]j-~~ }_   fv xn  Xk  J]{#''''''''''''`d88B&&8@BW@*8&0x''' o ````'''''`'''''``````````````````````````````````` ~p%bqLrwc(z]_*t~ f  { `    
      ?]  ?(-++_++?  {r z-Z \uxn q*O             B@%Wo#o#@#8W#W8B%##MM-''``'''''''''''''``'```''''''```````````````````````` aZ\q*hYp/f?~/Z_ /    '   
      - - }_]~  t   ?jzb t~fj j +p0        ~_--?+8@ah*#WWhkk*M8BB8%$o ''''''''''''''''''''''`````````'```````````````````````  `````` {O#dn +     '   
     +_ +{+_ _  _-  (0w u qL(u]/*q       ~+_?]{{?0&8W#*W#0Lwm8k##Mc            `'''' '''''''`````````'``````````````````````````'''``````` '  Jp `''  
+   ) ++) ~  +       CY  U )1xwn   ?0YrzXXJL[       aMkMB8%*&M#( `                   `''''''````````````````````````````````````````````````````````''
  +_  t{~-+~]~  ~  )?_   cc X '''(](\fjrnnvcuXJ '''''````  '``''```      ~+--_+         `'''``````````````````````````````````````````````````````''``
 _  ?~{-  +c~  _    {   \rt('   'C ~++-?]]}|/rC'```'''''''''````''''`      _[}}[]+       `''```````````````````````````````````'``````````````````````
 ___]\+ -//]m?+ /  j )   (]      -_   ~+-]/1 ` `''''''''```````'''''''''````   +-__++      ``````````````````'```````````````````        `````````````
_ _ _ [_~Uf  v_+\ - ] 1_  _      '`     `'``````````````''````'````'''''''''````    ~         ``````````````````'``'``````````'`                  ````
 +  ] ~1\? f} )\ Q + 1 ~{]_          ''''```''````````````````````'````'''''''''''``         ```'````' zoMho8C  ` `''```````````'                     
  )+-{\{ __+bZj  +]))}1 }~?1         ''''`````````````````````````''   ` `'`'''''''```        `````-o%8     o@%8k+```````'````````vn__++~~            
  }J _]++_?+Yf(-~zX_j{_] }{ [ `' '   ''''```````````````````````` X)tt|q  ``````````````     `` ` 8%B%B     hM@@B&h `````'``````` oUfffff\{][|/v?-_+  
 ]]~+1+(|r~{xv+zm+\x /_11 ?[\ f       '''''''```````````````````  [-}1)1j````````'``''````````  Y*8B*%%#M&88&BB@BB$( `````````'``8MOuxp(Cw{-)     '   
_ ~ 0 _?- \f]tzxqJ+[X-_)   1  ~\t '''''''''''''''''`````````````  U +_}r  ````````````  `````'`[#M%%&B8M8B&#M$8BB%@f'```````````o%kYmLLLjqvq(+{   ``' 
x  r]1-f+ juL])(c[rC\( _}/]`     |j'`'''''''''''''````````````'```   '``''`````````````'```''''_&8Bd%@M8#Wa88#@B@&# ```````````a8Zb#JJfxZUQwj}uj)    `
]))/ }++ z]~~/QXCC+tC{} X ' ''`    0Q'`''''''''''''`````````````'```` ``````````````````````````8BhqBBBaoBM#BM%%WW  ```````'` XM0UJzbxhYuZCpj/v/~?}  `
\?f(-1]~]Y)|-+o\Y\ ?[J Y_'   '''     vo  '' '''''''''''````````````````````````````````````````` @BC&oB8%8W#8BhbC `''````````)8JOMdoJYmCcvQJcvrn?{    
(]t}+ +n_ c+-\ U1Zd | Oz'       '`     ~at  `''''''''''`````````````````````````````````````````` B8MWQ8bba%W%c     ` ````` XW#b0wvbwOUCvzwCucjn\~    
f}]- c+ z  zc[]]1}cC+CZ'       ''''       ]o~   '''''''````````````````````````````````````````````  }b*ak0/|)()[_~      ` &##wpYZv0kCqxcUUvXmut]_{   
}{{{x~\|}   ?\] Q -~1q          ''''`        _Q   `````'```````````````````````````````````````````````    ?)\\\\|{]]+   u0mzk*phZm/vvOaUvcnucv/}~  +`
1f]?L[\ }u Y[) d }J})0      '''  '''''`      _)nOL[    `````````````'```````````````````````````````````    +?[)}{}[]?  oMpwMOuY00uZXmrXZUfcJfU\1  +  
[}1_mt_  vnZ~{n qt vhX      ''''''  ''''``   ~}/fffrvb]    ```````''```````````````````````````````` `  -jxuu}_?]]]][]-#nW&axmvuoLqmXQcnnzcJzYY)-?_+  
-}v++_]- [/]?_  /c +b?      ''''''''''''```   +][(\/\\//\[~     ``'````````````````````````````````  CvcXJLCCQZqf??]]Lqc0&QWzCpqC\XO#YuuuuUcuu/)[}_+_?
  ~- [ (?_   +   n  *       ''''''''''''''`   ~-]]{((jrxxxxxf\}      ```````````````````````'`````' q(\/fnccJQmOQ??}X8pka&CtZOLCxpcvCnkx0Xccuv\{}}--[?
   ?  -?-  )  \     M'     '  ''''''''''''`  ~---???{//ttft\\\\\(((}~    `````''''''''````````````' Q/\\\fuXJCCUY-?\%JuCdzZahzvkzQCY0fvCJnxJj\{|}??[_+
   _} ~ \   +~_?    *'     '  '''''''''''`   _++~   ?-]}1)|((|(|\\\\t/t//(+      ` ```````````       dxrxxnvYJLQ1+L8L0C0odkJhvQXXknwOXfjnjmtt{}}??}]_+
  + }  _ +? ?? )? {{a+   ''''''''''''''`    ?]]      ~~+__-?]][{1((|//ttt/j\/jUCj((+                  YakJn[]]}\%#Zpd&Qu0(wrpQC0fjjcx\\Z(nx[({1][[{_~ 
     _  -} ] [? +(1+Xx'  ''''''''''''`    r&q~                        +_-___--??-?_-+|Ca##pUX{}?___[[[[})vYok%djQMo0W/brmx/JY(]|vf\\fz{|1z/{[|}][)~~  
``     - +(~+? _\ -|+o' ''''    '``     Z*#[}-+              `````                   ~++_-__]11\\\/ttff/|L#Lpjh&kpWqCtY0xM#jQ|uY}\U/({|p[{){(]]]]_~   
    '`` ~ ( ~_}?]- 1~Q?'''           /&#OXzQod-[_~      j `'' '''''''`'''''''`'`           +-??}1\//t\w8B*Zrd00ZZcXozJn0wjkvzj/fc\t1|(}}}{{(}]]]+     
     '`     }  1({ ~)_W '   ~--_~ -W&Wb&)xd*mqY|Mn_    p` ''''''''''''''''''''''`'         +-?]]{|\x%B8abxYhCZvzpoQuXYhufJfvfYOjf\j)}}}}}}}}}??~    ' 
     '`   }~-_   ?/\ _?Cp#MJ   x8Mo_vmjmYcoxrranC{}O*[J '''''''''''''''''''''''``          +-??]{f8*d8nJYZmcaY&CYxXvXLZxf/nvvjjfv1{}}}}}}}}}]_        
     '`              -c ]   ukt+x[|#~/)Uw1JOXCaC*nc ]X` '   '''''''''''''''''''`          +-]??hWqr#ha*LOzmUYhUjfZJJ/cvQrcnufXutj1{}}}}}}}[]+   `     
     ''             _  _~nt ?_}{JJ?z\)|)M(JY#~mZCUfL?_''    ''''''''``'`''`''``         ~~]_zOaf0OqnpO#UXQQnLJvYn/nwn(/YvXnnf/r{}}{{}}}}}]?_   ''     
       ''`              -?}++a})]/xw- 0)Y/urUcf()b#_c'''  ' '''`'''''`''''``           +?xkkk&#jpbMhXLZrQMdv_0jQjj[{(Zt\|v(/Y\?[}}}}}}}[?+   '        
          '''           ? ]-?t-/(C+}tOO?[(-ZLd qZY W' '   '''`''''`''''''             -*bOd#8M%8*o8M8&QxfObcf?1Z\[](})[zxt][}}}}}}}}}[?++  `'         
                 ''        [?{[)\)/}0]x#{u{j+f[Q?}X1`'`   `'''''''''               v*LqmLnmppLYz#vXxrfzcxp1Xjf{|}/)/1)1/}{\cU[[[[[[]]_~   `'          
                          ? ____x1\-[uv(}1]u_?|\0{J[                   ++++~   JdMa%W/uOqmUjJJJjfXU0(0|1v1{}]}jn}][{|1/1]/)[}}}}]]?+~   `'            
                    '     ~ _+ ~++???- }_{{{  ?hY+ \zqb ~-]}1111{---][}}?]CaXjLqwfY#&ovOO#cZU#h%Cvt1J_1|][)\]|??]\Q]{])([]]]]?--_~     '              
                     ' `         ~   +[_-+]_t}(~__\}][+Lpz_+-]{\11JodUv*xXf(Odavvfn/pkX|f?vJ\}n1w][}/rr]?+~+??1f _+}-__?--_+~~      ''                
                         '`             ~?[-+-]\{-)}/L|(1((u[x]Ymrr\Yfa(f(XLCdx)CYYr|+1|f]z]|qn\x\vX\]+_?|z      _              `'                    
                           ''`''`          +()??-+v({n(|\?x))-\]}r?r1v1wY)U[]/xq/{jj?QjJzZ0(//co?1[--/f  _ `    '``` ```'`''                          
                                          ( ~++(j]?\t{/}]\]x|])]\?zx})}1)|{z/?1nfv))f/(wj}[t1)[]??t-     ` ''                                         
                                     ''      ?? __+]]?[]}|[[]?()-]{?]??_???-[+[)xfxtn([]]]]_]}-/ ?~   `''                                             
                                         ''        ~~~~~~~+++++__+____~]]       +~++++~~+~        '                                                   
                                             '`                     {                       `''                                                       

*/

#include <iostream>
#include <string>
using namespace std;

int RC4(int n)
{
	int S[1024];
	char T[1024];
	string key;
	int k = 0;

	memset(S, 0, 1024);
	memset(T, 0, 1024);
	int i;
	for (i = 0; i < n; i++)
	{
		S[i] = i;
	}
	cout << "Please enter the key：" << endl;
	cin >> key;
	int len = key.length();
	int j = 0;
	for (i = 0; i < n; i++)
	{
		if (j == len) j = 0;
		else
		{
			T[i] = key[j];
			j++;
		}
	}

	j = 0;
	for (i = 0; i < n; i++)
	{
		j = (j + S[i] + T[i]) % n;
		swap(S[i], S[j]);
	}


	i = 0;
	j = 0;
	//while (true)
	//{
		i = (i + 1) % n;
		j = (j + S[i]) % n;
		swap(S[i], S[j]);
		int t = (S[i] + S[j]) % n;
		k = S[t];
	//	if(getchar()) cout << k;
	//}

	return k;
}

class DH
{
public:
	DH(int pp, int qq);
	~DH();
	int A();
	int B();
	int S();

private:
	int a;
	int q;
	int Xa;
	int Xb;
	int Yb;
	int Ya;
};

DH::DH(int aa, int qq)
{
	a = aa;
	q = qq;
	A();
	B();
}

DH::~DH()
{
}

int DH::A()
{
	Xa = RC4(q);
	cout << "Xa:" << Xa << endl;
	Ya = a;
	for (int i = 1; i < Xa; i++)
	{
		Ya = Ya * Ya % q;
	}
	cout << "Ya:" << Ya << endl;
	return 0;
}

int DH::B()
{
	Xb = RC4(q);
	cout << "Xb:" << Xb << endl;
	Yb = a;
	for (int i = 1; i < Xb; i++)
	{
		Yb = Yb * Yb % q;
	}
	cout << "Yb:" << Yb << endl;
	return 0;
}

int DH::S()
{
	int Sa = Yb;
	for (int i = 1; i < Xa; i++)
	{
		Sa = Sa * Sa % q;
	}
	cout << "Sa:" << Sa << endl;

	int Sb = Ya;
	for (int i = 1; i < Xb; i++)
	{
		Sb = Sb * Sb % q;
	}
	cout << "Sb:" << Sb << endl;

	return 0;
}

int main()
{
	int a = 3;
	int q = 23;
	DH dh = DH(a, q);

	dh.A();
	dh.B();
	dh.S();

    return 0;
}